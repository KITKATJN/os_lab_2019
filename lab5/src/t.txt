Происходит все потому что поток не заблокирован, а значит несколько процессов единовременно меняют переменную
gcc -pthread  factorial.c
./a.out --k "30" --pnum "1" --mod "47"


X начинает использовать A.
X и Y пытаются начать использовать B
Y 'выигрывает' и первым получает B
теперь Y нужно использовать A
A заблокирован X, который ждет Y
